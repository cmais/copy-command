<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro MP3 Player Sidebar</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>

    <style>
        :root {
            --bg-color: #0c0c0c;
            --card-bg: #181818;
            --text-color: #ffffff;
            --accent-color: #1db954;
            --secondary-text: #b3b3b3;
            --input-bg: #282828;
            --hover-bg: #3e3e3e;
            --border-color: #333;
        }

        .light-mode {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #1c1e21;
            --accent-color: #007bff;
            --secondary-text: #606770;
            --input-bg: #f0f2f5;
            --hover-bg: #e4e6eb;
            --border-color: #ddd;
        }

        * { box-sizing: border-box; transition: background 0.2s, color 0.2s; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        /* Container Principal (Lado a Lado) */
        .app-container {
            display: flex;
            flex-direction: row; /* Alinha horizontalmente */
            gap: 20px;
            max-width: 900px;
            width: 100%;
            align-items: stretch;
        }

        /* Coluna do Player */
        .player-card {
            background-color: var(--card-bg);
            padding: 2.5rem;
            border-radius: 24px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            width: 400px;
            flex-shrink: 0; /* Não deixa o player encolher */
            text-align: center;
        }

        /* Coluna da Playlist */
        .playlist-card {
            background-color: var(--card-bg);
            border-radius: 24px;
            padding: 1.5rem;
            flex-grow: 1; /* Ocupa o restante do espaço */
            display: flex;
            flex-direction: column;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            max-height: 620px; /* Altura fixa para alinhar com o player */
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .file-label {
            background: var(--accent-color);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.85rem;
            cursor: pointer;
            font-weight: 600;
        }

        #theme-toggle {
            background: var(--input-bg);
            border: none;
            color: var(--text-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Capa */
        .cover-wrapper {
            width: 250px;
            height: 250px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            background: #222;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }
        #cover { width: 100%; height: 100%; object-fit: cover; }

        /* Track Info */
        .track-info h2 { margin: 10px 0 5px; font-size: 1.3rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .track-info p { color: var(--secondary-text); margin-bottom: 25px; }

        /* Progress */
        .progress-area { margin-bottom: 20px; }
        .time-info { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--secondary-text); margin-bottom: 10px; }
        input[type="range"] { width: 100%; accent-color: var(--accent-color); cursor: pointer; }

        /* Controls */
        .main-controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 20px; }
        .btn-ctrl { background: none; border: none; color: var(--text-color); font-size: 1.2rem; cursor: pointer; }
        .btn-ctrl:hover { color: var(--accent-color); transform: scale(1.1); }
        .play-pause-btn { width: 60px; height: 60px; background: var(--accent-color); color: white !important; border-radius: 50%; font-size: 1.5rem; box-shadow: 0 4px 12px rgba(29, 185, 84, 0.4); }

        /* Playlist Styles */
        .playlist-header { font-size: 1.1rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 10px; }
        #playlist-list { overflow-y: auto; flex-grow: 1; padding-right: 5px; }
        .playlist-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 8px;
            background: transparent;
        }
        .playlist-item:hover { background: var(--hover-bg); }
        .playlist-item.active { background: var(--hover-bg); color: var(--accent-color); font-weight: bold; }
        .playlist-item span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Responsividade para Celular */
        @media (max-width: 850px) {
            .app-container { flex-direction: column; align-items: center; }
            .player-card, .playlist-card { width: 100%; max-width: 400px; }
        }

        #file-input { display: none; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--secondary-text); border-radius: 10px; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="player-card">
            <div class="top-bar">
                <label for="file-input" class="file-label"><i class="fas fa-plus-circle"></i> Carregar</label>
                <input type="file" id="file-input" accept="audio/mp3" multiple>
                <button id="theme-toggle"><i class="fas fa-moon"></i></button>
            </div>

            <div class="cover-wrapper">
                <img id="cover" src="https://via.placeholder.com/300x300?text=Pro+Player" alt="Capa">
            </div>

            <div class="track-info">
                <h2 id="title">Aguardando...</h2>
                <p id="artist">Selecione suas músicas</p>
            </div>

            <audio id="main-audio"></audio>

            <div class="progress-area">
                <div class="time-info">
                    <span id="current-time">0:00</span>
                    <span id="total-time">0:00</span>
                </div>
                <input type="range" id="seek-bar" value="0">
            </div>

            <div class="main-controls">
                <button id="prev-btn" class="btn-ctrl"><i class="fas fa-backward-step"></i></button>
                <button id="play-pause-btn" class="btn-ctrl play-pause-btn"><i class="fas fa-play"></i></button>
                <button id="next-btn" class="btn-ctrl"><i class="fas fa-forward-step"></i></button>
                <button id="stop-btn" class="btn-ctrl"><i class="fas fa-stop"></i></button>
            </div>

            <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                <button id="mute-btn" class="btn-ctrl" style="font-size: 0.9rem;"><i class="fas fa-volume-up"></i></button>
                <input type="range" id="volume-bar" value="100" max="100" style="width: 80px;">
            </div>
        </div>

        <div class="playlist-card">
            <div class="playlist-header">
                <i class="fas fa-list"></i> Minha Playlist
            </div>
            <div id="playlist-list">
                <p style="color: var(--secondary-text); font-size: 0.8rem; text-align: center; margin-top: 20px;">Nenhuma música na fila.</p>
            </div>
        </div>
    </div>

    <script>
        const jsmediatags = window.jsmediatags;
        const audio = document.getElementById('main-audio');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const fileInput = document.getElementById('file-input');
        const playlistList = document.getElementById('playlist-list');
        
        let playlist = [];
        let currentIndex = 0;

        // Seleção de arquivos
        fileInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            files.forEach(file => {
                playlist.push({
                    file: file,
                    url: URL.createObjectURL(file),
                    name: file.name.replace('.mp3', '')
                });
            });

            updatePlaylistUI();
            if (!audio.src) loadTrack(0);
        });

        function updatePlaylistUI() {
            playlistList.innerHTML = "";
            playlist.forEach((song, index) => {
                const item = document.createElement('div');
                item.className = `playlist-item ${index === currentIndex ? 'active' : ''}`;
                item.innerHTML = `<i class="fas fa-music" style="margin-right: 10px; font-size: 0.7rem;"></i> <span>${song.name}</span>`;
                item.onclick = () => loadTrack(index);
                playlistList.appendChild(item);
            });
        }

        function loadTrack(index) {
            if (index < 0 || index >= playlist.length) return;
            currentIndex = index;
            const song = playlist[currentIndex];
            audio.src = song.url;
            
            // Ler Tags ID3
            jsmediatags.read(song.file, {
                onSuccess: function(tag) {
                    const tags = tag.tags;
                    document.getElementById('title').innerText = tags.title || song.name;
                    document.getElementById('artist').innerText = tags.artist || "Artista Desconhecido";
                    
                    const img = tags.picture;
                    if (img) {
                        let base64String = "";
                        for (let i = 0; i < img.data.length; i++) base64String += String.fromCharCode(img.data[i]);
                        document.getElementById('cover').src = "data:" + img.format + ";base64," + window.btoa(base64String);
                    } else {
                        document.getElementById('cover').src = "https://via.placeholder.com/300x300?text=Sem+Capa";
                    }
                },
                onError: () => {
                    document.getElementById('title').innerText = song.name;
                    document.getElementById('cover').src = "https://via.placeholder.com/300x300?text=Sem+Capa";
                }
            });

            audio.play();
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            updatePlaylistUI();
        }

        // Eventos de Botões
        playPauseBtn.onclick = () => {
            if (audio.paused) { audio.play(); playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>'; }
            else { audio.pause(); playPauseBtn.innerHTML = '<i class="fas fa-play"></i>'; }
        };

        document.getElementById('next-btn').onclick = () => {
            currentIndex = (currentIndex + 1) % playlist.length;
            loadTrack(currentIndex);
        };

        document.getElementById('prev-btn').onclick = () => {
            currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
            loadTrack(currentIndex);
        };

        document.getElementById('stop-btn').onclick = () => { 
            audio.pause(); audio.currentTime = 0; 
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>'; 
        };

        audio.onended = () => document.getElementById('next-btn').click();

        // Progresso e Volume
        audio.ontimeupdate = () => {
            if (audio.duration) {
                document.getElementById('seek-bar').value = (audio.currentTime / audio.duration) * 100;
                document.getElementById('current-time').innerText = formatTime(audio.currentTime);
                document.getElementById('total-time').innerText = formatTime(audio.duration);
            }
        };

        document.getElementById('seek-bar').oninput = (e) => { audio.currentTime = (e.target.value / 100) * audio.duration; };
        document.getElementById('volume-bar').oninput = (e) => audio.volume = e.target.value / 100;
        
        document.getElementById('mute-btn').onclick = () => {
            audio.muted = !audio.muted;
            document.getElementById('mute-btn').innerHTML = audio.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
        };

        document.getElementById('theme-toggle').onclick = () => {
            document.body.classList.toggle('light-mode');
            document.getElementById('theme-toggle').innerHTML = document.body.classList.contains('light-mode') ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        };

        function formatTime(s) { 
            const m = Math.floor(s/60); 
            const sec = Math.floor(s%60); 
            return `${m}:${sec < 10 ? '0' + sec : sec}`; 
        }
    </script>
</body>
</html>
